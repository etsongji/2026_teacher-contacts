<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÍµêÏÇ¨ Ïó∞ÎùΩÏ≤ò</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f4f6fb;
    --card: #ffffff;
    --card-hover: #f0f4ff;
    --accent: #3b6ef8;
    --accent2: #6c4fff;
    --text: #1a1d2e;
    --muted: #8891aa;
    --border: #e2e6f0;
    --tag-bg: #eef1fa;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding-bottom: 40px;
  }

  header {
    background: #fff;
    border-bottom: 1px solid var(--border);
    padding: 28px 20px 16px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  }

  .header-title {
    font-size: 22px; font-weight: 700; letter-spacing: -0.5px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; margin-bottom: 4px;
  }

  .header-sub { font-size: 12px; color: var(--muted); margin-bottom: 14px; }

  .search-bar { position: relative; }

  .search-bar input {
    width: 100%; background: var(--bg); border: 1.5px solid var(--border);
    border-radius: 12px; padding: 12px 16px 12px 42px; color: var(--text);
    font-size: 15px; font-family: 'Noto Sans KR', sans-serif; outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .search-bar input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,110,248,0.12); }
  .search-bar input::placeholder { color: var(--muted); }

  .search-icon {
    position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
    color: var(--muted); font-size: 16px; pointer-events: none;
  }

  /* ‚îÄ‚îÄ Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ 2Îã® ‚îÄ‚îÄ */
  .filter-section {
    background: #fff;
    border-bottom: 1px solid var(--border);
    padding-bottom: 10px;
  }

  .filter-row-big {
    display: flex; gap: 8px; overflow-x: auto;
    padding: 12px 16px 0; scrollbar-width: none;
  }
  .filter-row-big::-webkit-scrollbar { display: none; }

  .filter-row-sub {
    display: flex; gap: 6px; overflow-x: auto;
    padding: 8px 16px 0; scrollbar-width: none;
    min-height: 36px;
  }
  .filter-row-sub::-webkit-scrollbar { display: none; }

  .filter-btn-big {
    background: var(--tag-bg); border: 1.5px solid var(--border);
    border-radius: 20px; padding: 7px 16px; color: var(--muted);
    font-size: 14px; font-family: 'Noto Sans KR', sans-serif;
    white-space: nowrap; cursor: pointer; transition: all 0.2s;
    flex-shrink: 0; font-weight: 600;
  }

  .filter-btn-big.active {
    background: var(--accent); border-color: var(--accent); color: #fff;
  }

  .filter-btn-sub {
    background: #fff; border: 1.5px solid var(--border);
    border-radius: 16px; padding: 5px 12px; color: var(--muted);
    font-size: 12px; font-family: 'Noto Sans KR', sans-serif;
    white-space: nowrap; cursor: pointer; transition: all 0.2s;
    flex-shrink: 0; font-weight: 500;
  }

  .filter-btn-sub.active {
    background: #e8eeff; border-color: var(--accent); color: var(--accent); font-weight: 700;
  }

  .filter-btn-sub:hover { border-color: var(--accent); color: var(--accent); }

  .status-bar {
    display: flex; justify-content: flex-end;
    padding: 10px 20px 2px; font-size: 11px;
    font-family: 'DM Mono', monospace; color: var(--muted);
  }

  .contacts-list { padding: 4px 16px 0; }

  .section-label {
    font-size: 11px; font-weight: 700; letter-spacing: 1.5px;
    color: var(--muted); text-transform: uppercase; padding: 14px 4px 6px;
  }

  .contact-card {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 16px; padding: 14px 16px;
    display: flex; align-items: center; gap: 14px;
    cursor: pointer; transition: all 0.2s; color: inherit;
    margin-bottom: 8px; animation: fadeIn 0.3s ease forwards; opacity: 0;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }

  .contact-card:hover, .contact-card:active {
    background: var(--card-hover); border-color: var(--accent);
    transform: translateY(-1px); box-shadow: 0 4px 20px rgba(59,110,248,0.12);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .avatar {
    width: 46px; height: 46px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 17px; font-weight: 700; flex-shrink: 0; color: #fff;
  }

  .contact-info { flex: 1; min-width: 0; }

  .contact-name { font-size: 15px; font-weight: 600; margin-bottom: 3px; letter-spacing: -0.3px; color: var(--text); }
  .contact-subject { font-size: 12px; color: var(--muted); margin-bottom: 3px; }
  .contact-phone { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--accent); font-weight: 500; }

  .card-arrow {
    width: 28px; height: 28px; border-radius: 50%;
    background: var(--tag-bg); display: flex; align-items: center;
    justify-content: center; flex-shrink: 0; color: var(--muted);
    font-size: 13px; transition: all 0.2s;
  }

  .contact-card:hover .card-arrow { background: var(--accent); color: #fff; }

  .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
  .empty-state .emoji { font-size: 36px; margin-bottom: 10px; }
  .empty-state p { font-size: 14px; }

  /* ‚îÄ‚îÄ Ïï°ÏÖò ÏãúÌä∏ ‚îÄ‚îÄ */
  .sheet-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.35);
    z-index: 300; display: flex; align-items: flex-end;
    backdrop-filter: blur(3px); animation: fadeBg 0.2s ease;
  }

  @keyframes fadeBg { from { opacity:0; } to { opacity:1; } }

  .sheet {
    background: #fff; border-radius: 24px 24px 0 0;
    width: 100%; padding: 12px 16px 44px;
    animation: slideUp 0.25s cubic-bezier(.32,1,.6,1);
    box-shadow: 0 -4px 30px rgba(0,0,0,0.1);
  }

  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

  .sheet-handle { width: 36px; height: 4px; background: #e2e6f0; border-radius: 2px; margin: 0 auto 18px; }

  .sheet-profile {
    display: flex; align-items: center; gap: 14px;
    padding: 0 4px 18px; border-bottom: 1px solid #f0f2f8; margin-bottom: 14px;
  }

  .sheet-avatar {
    width: 54px; height: 54px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; font-weight: 700; color: #fff; flex-shrink: 0;
  }

  .sheet-name { font-size: 19px; font-weight: 700; letter-spacing: -0.4px; color: #1a1d2e; margin-bottom: 3px; }
  .sheet-subject { font-size: 13px; color: #8891aa; margin-bottom: 4px; }
  .sheet-phone { font-family: 'DM Mono', monospace; font-size: 14px; color: #3b6ef8; font-weight: 500; }

  .sheet-actions { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }

  .sheet-btn {
    display: flex; align-items: center; gap: 16px;
    width: 100%; background: #f4f6fb; border: none;
    border-radius: 16px; padding: 15px 18px;
    font-size: 15px; font-family: 'Noto Sans KR', sans-serif;
    font-weight: 600; color: #1a1d2e; cursor: pointer;
    transition: background 0.15s; text-align: left; text-decoration: none;
  }

  .sheet-btn:active, .sheet-btn:hover { background: #e8edf8; }

  .btn-icon {
    width: 42px; height: 42px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 19px; flex-shrink: 0;
  }

  .btn-call .btn-icon { background: linear-gradient(135deg,#3b6ef8,#6c4fff); }
  .btn-save .btn-icon { background: linear-gradient(135deg,#1dd1a1,#10ac84); }

  .btn-text { flex: 1; }
  .btn-desc { font-size: 12px; font-weight: 400; color: #8891aa; margin-top: 2px; }

  .sheet-cancel {
    display: block; width: 100%; background: none;
    border: 1.5px solid #e2e6f0; border-radius: 14px; padding: 14px;
    font-size: 15px; font-family: 'Noto Sans KR', sans-serif; font-weight: 600;
    color: #8891aa; cursor: pointer; margin-top: 4px; transition: all 0.15s;
  }

  .sheet-cancel:hover { background: #f4f6fb; }
</style>
</head>
<body>

<header>
  <div class="header-title">üìã ÍµêÏÇ¨ Ïó∞ÎùΩÏ≤ò</div>
  <div class="header-sub">Ïù¥Î¶ÑÏùÑ ÌÉ≠ÌïòÎ©¥ Ï†ÑÌôî¬∑Ï†ÄÏû• ÏÑ†ÌÉù</div>
  <div class="search-bar">
    <span class="search-icon">üîç</span>
    <input type="text" id="searchInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÍµêÍ≥ºÎ°ú Í≤ÄÏÉâ..." oninput="onSearch()">
  </div>
</header>

<div class="filter-section">
  <div class="filter-row-big" id="filterBig"></div>
  <div class="filter-row-sub" id="filterSub"></div>
</div>

<div class="status-bar"><span id="countBadge"></span></div>
<div class="contacts-list" id="contactsList"></div>

<!-- Ïï°ÏÖò ÏãúÌä∏ -->
<div class="sheet-overlay" id="sheetOverlay" style="display:none" onclick="if(event.target===this)closeSheet()">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-profile">
      <div class="sheet-avatar" id="sheetAvatar"></div>
      <div>
        <div class="sheet-name" id="sheetName"></div>
        <div class="sheet-subject" id="sheetSubject"></div>
        <div class="sheet-phone" id="sheetPhone"></div>
      </div>
    </div>
    <div class="sheet-actions">
      <a class="sheet-btn btn-call" id="btnCall" href="#">
        <div class="btn-icon">üìû</div>
        <div class="btn-text">Ï†ÑÌôî Í±∏Í∏∞<div class="btn-desc">Î∞îÎ°ú ÌÜµÌôî Ïó∞Í≤∞</div></div>
      </a>
      <button class="sheet-btn btn-save" onclick="saveContact()">
        <div class="btn-icon">üíæ</div>
        <div class="btn-text">Ïó∞ÎùΩÏ≤ò Ï†ÄÏû•<div class="btn-desc">Ìú¥ÎåÄÌè∞ Ïó∞ÎùΩÏ≤òÏóê Ï∂îÍ∞Ä</div></div>
      </button>
    </div>
    <button class="sheet-cancel" onclick="closeSheet()">Ï∑®ÏÜå</button>
  </div>
</div>

<script>
const CONTACTS = [
  {name:"Ïù¥Í∑úÌõà", subject:"ÍµêÏû•", phone:"010-5247-4167"},
  {name:"ÏûÑÏÑ±Í∑ú", subject:"ÍµêÍ∞ê", phone:"010-9460-9640"},
  {name:"ÍπÄÎ¨∏Ïö©", subject:"ÌñâÏ†ïÎ∂ÄÏû•", phone:"010-6750-1084"},
  {name:"ÍπÄÎØ∏Í≤Ω", subject:"ÌñâÏ†ïÏã§Ïû•", phone:"010-2014-9895"},
  {name:"Î∞ïÎØ∏ÏÑ†", subject:"ÌñâÏ†ïÏã§Î¨¥ÏÇ¨", phone:"010-2074-8736"},
  {name:"Î∞ïÏÜåÌòÑ", subject:"Ï£ºÎ¨¥Í¥Ä", phone:"010-4471-4871"},
  {name:"Î∞ïÏßÄÏõÖ", subject:"Ï£ºÎ¨¥Í¥Ä", phone:"010-2824-1940"},
  {name:"Ïù¥Ï∂©Í∑ú", subject:"Ï£ºÎ¨¥Í¥Ä", phone:"010-3410-6649"},
  {name:"Ï°∞ÏùÄÏ£º", subject:"ÍµêÎ¨¥Ïã§Î¨¥ÏÇ¨", phone:"010-2649-6158"},
  {name:"ÍπÄÎØºÏ†ï", subject:"ÍµêÎ¨¥Ïã§Î¨¥ÏÇ¨", phone:"010-4709-1429"},
  {name:"Í∞ïÏ†ïÏàô", subject:"ÏàòÌïô", phone:"010-6463-1654"},
  {name:"Í∂åÏò§ÎØ∏", subject:"ÏùºÎ∞òÏÇ¨Ìöå", phone:"010-5278-0603"},
  {name:"ÍπÄÍ∏∞Ï§Ä", subject:"ÏàòÌïô", phone:"010-8844-5897"},
  {name:"ÍπÄÏÉÅÌõà", subject:"Ï≤¥Ïú°", phone:"010-3711-8074"},
  {name:"ÍπÄÏÑ†ÎØ∏", subject:"ÏÇ¨ÏÑú", phone:"010-8719-7365"},
  {name:"ÍπÄÏäπÌòÅ", subject:"Î¨ºÎ¶¨", phone:"010-3333-6899"},
  {name:"ÍπÄÏùÄÏßÄ", subject:"ÏùºÎ∞òÏÇ¨Ìöå", phone:"010-7599-6438"},
  {name:"ÍπÄÌòÑÏö∞", subject:"Íµ≠Ïñ¥", phone:"010-2461-3276"},
  {name:"ÍπÄÌòÑÏ†ï", subject:"ÏÉùÎ™ÖÍ≥ºÌïô", phone:"010-9406-4085"},
  {name:"ÍπÄÌòÑÏßÑ", subject:"Ïó≠ÏÇ¨", phone:"010-5560-4904"},
  {name:"ÍπÄÌòúÎØº", subject:"Î≥¥Í±¥", phone:"010-8561-2560"},
  {name:"ÍπÄÌòúÏù∏", subject:"ÏòÅÏñ¥", phone:"010-2392-1461"},
  {name:"ÍπÄÌò∏ÏÑ±", subject:"ÏßÑÎ°ú", phone:"010-8842-4979"},
  {name:"ÍπÄÌù¨Ïàò", subject:"ÏàòÌïô", phone:"010-7670-5037"},
  {name:"ÎÇòÏú§Ï£º", subject:"Ïú§Î¶¨", phone:"010-9857-6860"},
  {name:"Î∞ïÎèôÌôò", subject:"ÏßÄÍµ¨Í≥ºÌïô", phone:"010-3289-5385"},
  {name:"Î∞ïÏùµÏÑ†", subject:"ÏàòÌïô", phone:"010-4465-7238"},
  {name:"Î∞ïÏßÄÌõà", subject:"Ï†ïÎ≥¥", phone:"010-8887-5792"},
  {name:"Î≥ÄÏßÄÌòï", subject:"ÏßÄÍµ¨Í≥ºÌïô", phone:"010-2325-2570"},
  {name:"ÏÑúÏòàÎ¶º", subject:"ÏùåÏïÖ", phone:"010-2900-0030"},
  {name:"ÏÜ°ÏßÄÏñ∏", subject:"ÏòÅÏñ¥", phone:"010-5192-2897"},
  {name:"Ïã†ÎèôÌò∏", subject:"Íµ≠Ïñ¥", phone:"010-5566-1763"},
  {name:"Ïã†ÌòÑÏ§Ä", subject:"ÏßÄÎ¶¨", phone:"010-4001-7149"},
  {name:"ÏïàÍ∑ºÌò∏", subject:"ÏùºÎ≥∏Ïñ¥", phone:"010-5596-0085"},
  {name:"ÏïàÏßÑÌòï", subject:"Î¨ºÎ¶¨", phone:"010-3463-5426"},
  {name:"Ïö∞ÎßåÏãù", subject:"Ïó≠ÏÇ¨", phone:"010-3679-3057"},
  {name:"ÏúÑÌÉúÏö©", subject:"Ï≤¥Ïú°", phone:"010-7372-8897"},
  {name:"Ïú†ÏßÑÌù¨", subject:"ÏòÅÏñ¥", phone:"010-9737-5422"},
  {name:"Ïú°Í∞êÏö∞", subject:"ÏàòÌïô", phone:"010-3311-1005"},
  {name:"Ïú§Ï§ÄÌò∏", subject:"ÏàòÌïô", phone:"010-9218-5719"},
  {name:"Ïù¥ÎØºÏ†ï", subject:"ÏàòÌïô", phone:"010-2996-5573"},
  {name:"Ïù¥Î≥ëÎ™®", subject:"ÏÉùÎ™ÖÍ≥ºÌïô", phone:"010-3474-2707"},
  {name:"Ïù¥ÏÉòÎÇò", subject:"ÏòÅÏñë", phone:"010-4780-7276"},
  {name:"Ïù¥Ïä¨Ïù¥", subject:"ÏòÅÏñ¥", phone:"010-5761-8667"},
  {name:"Ïù¥Ï§ÄÌòÑ", subject:"Íµ≠Ïñ¥", phone:"010-3401-1680"},
  {name:"Ïù¥ÌïúÎ≥Ñ", subject:"Íµ≠Ïñ¥", phone:"010-2295-4256"},
  {name:"Ï†ÑÏùÄÏòÅ", subject:"ÏòÅÏñ¥", phone:"010-4394-0423"},
  {name:"Ï†ÑÌö®ÎÇò", subject:"ÏßÄÎ¶¨", phone:"010-8720-2976"},
  {name:"Ï†ÑÌù¨Ï£º", subject:"ÌîÑÎûëÏä§Ïñ¥", phone:"010-2331-0562"},
  {name:"Ï†ïÎØ∏Ï†ï", subject:"ÏòÅÏñ¥", phone:"010-8641-3392"},
  {name:"Ï†ïÌòúÏ†ï", subject:"ÎØ∏Ïà†", phone:"010-4536-2931"},
  {name:"Ï°∞ÎÇ®ÌòÅ", subject:"Ïó≠ÏÇ¨", phone:"010-2644-9827"},
  {name:"ÏµúÏÑúÏùÄ", subject:"Íµ≠Ïñ¥", phone:"010-5487-0639"},
  {name:"ÌëúÎØºÌù¨", subject:"ÌôîÌïô", phone:"010-9602-3361"},
  {name:"ÌïúÍ±¥Ìù¨", subject:"ÌôîÌïô", phone:"010-9270-0519"},
  {name:"ÌôçÏÑ±Í±¥", subject:"Ï≤¥Ïú°", phone:"010-2694-2248"},
  {name:"Ìô©Ïù∏Ìôò", subject:"Íµ≠Ïñ¥", phone:"010-2744-9027"},
  {name:"Ìô©Ìù¨Ï†ï", subject:"Íµ≠Ïñ¥", phone:"010-9218-0326"},
];

// ‚îÄ‚îÄ ÎåÄÎ∂ÑÎ•ò Í∑∏Î£π Ï†ïÏùò ‚îÄ‚îÄ
const GROUPS = [
  { label: 'Ï†ÑÏ≤¥',   subs: [] },
  { label: 'Í¥ÄÎ¶¨Ïûê', subs: ['ÍµêÏû•','ÍµêÍ∞ê'] },
  { label: 'ÌñâÏ†ïÏã§', subs: ['ÌñâÏ†ïÎ∂ÄÏû•','ÌñâÏ†ïÏã§Ïû•','ÌñâÏ†ïÏã§Î¨¥ÏÇ¨','Ï£ºÎ¨¥Í¥Ä','ÍµêÎ¨¥Ïã§Î¨¥ÏÇ¨'] },
  { label: 'Íµ≠Ïñ¥',   subs: ['Íµ≠Ïñ¥'] },
  { label: 'ÏòÅÏñ¥',   subs: ['ÏòÅÏñ¥'] },
  { label: 'ÏàòÌïô',   subs: ['ÏàòÌïô'] },
  { label: 'Í≥ºÌïô',   subs: ['Î¨ºÎ¶¨','ÌôîÌïô','ÏÉùÎ™ÖÍ≥ºÌïô','ÏßÄÍµ¨Í≥ºÌïô'] },
  { label: 'ÏÇ¨Ìöå',   subs: ['ÏùºÎ∞òÏÇ¨Ìöå','Ïó≠ÏÇ¨','ÏßÄÎ¶¨','Ïú§Î¶¨'] },
  { label: 'ÏòàÏ≤¥Îä•', subs: ['Ï≤¥Ïú°','ÏùåÏïÖ','ÎØ∏Ïà†'] },
  { label: 'Ïô∏Íµ≠Ïñ¥', subs: ['ÏùºÎ≥∏Ïñ¥','ÌîÑÎûëÏä§Ïñ¥'] },
  { label: 'Í∏∞ÌÉÄ',   subs: ['Ï†ïÎ≥¥','ÏßÑÎ°ú','Î≥¥Í±¥','ÏòÅÏñë','ÏÇ¨ÏÑú'] },
];

const SUBJECT_COLORS = {
  "ÍµêÏû•":"linear-gradient(135deg,#2d3436,#636e72)",
  "ÍµêÍ∞ê":"linear-gradient(135deg,#485460,#808e9b)",
  "ÌñâÏ†ïÎ∂ÄÏû•":"linear-gradient(135deg,#e17055,#d35400)",
  "ÌñâÏ†ïÏã§Ïû•":"linear-gradient(135deg,#e67e22,#f39c12)",
  "ÌñâÏ†ïÏã§Î¨¥ÏÇ¨":"linear-gradient(135deg,#f9ca24,#f0932b)",
  "Ï£ºÎ¨¥Í¥Ä":"linear-gradient(135deg,#badc58,#6ab04c)",
  "ÍµêÎ¨¥Ïã§Î¨¥ÏÇ¨":"linear-gradient(135deg,#22a6b3,#30336b)",
  "ÏàòÌïô":"linear-gradient(135deg,#4f7cff,#7c4fff)",
  "Íµ≠Ïñ¥":"linear-gradient(135deg,#ff6b6b,#ee5a24)",
  "ÏòÅÏñ¥":"linear-gradient(135deg,#1dd1a1,#10ac84)",
  "Ïó≠ÏÇ¨":"linear-gradient(135deg,#ff9f43,#ee5a24)",
  "ÏßÄÎ¶¨":"linear-gradient(135deg,#f9a825,#feca57)",
  "ÏùºÎ∞òÏÇ¨Ìöå":"linear-gradient(135deg,#ff6b81,#c0392b)",
  "Ïú§Î¶¨":"linear-gradient(135deg,#a29bfe,#6c5ce7)",
  "Î¨ºÎ¶¨":"linear-gradient(135deg,#74b9ff,#0984e3)",
  "ÌôîÌïô":"linear-gradient(135deg,#fd79a8,#e84393)",
  "ÏÉùÎ™ÖÍ≥ºÌïô":"linear-gradient(135deg,#55efc4,#00b894)",
  "ÏßÄÍµ¨Í≥ºÌïô":"linear-gradient(135deg,#fdcb6e,#e17055)",
  "Ï≤¥Ïú°":"linear-gradient(135deg,#d63031,#e17055)",
  "ÏùåÏïÖ":"linear-gradient(135deg,#a29bfe,#fd79a8)",
  "ÎØ∏Ïà†":"linear-gradient(135deg,#fd79a8,#fdcb6e)",
  "Ï†ïÎ≥¥":"linear-gradient(135deg,#00cec9,#0984e3)",
  "ÏßÑÎ°ú":"linear-gradient(135deg,#6c5ce7,#a29bfe)",
  "Î≥¥Í±¥":"linear-gradient(135deg,#ff7675,#d63031)",
  "ÏòÅÏñë":"linear-gradient(135deg,#55efc4,#fdcb6e)",
  "ÏÇ¨ÏÑú":"linear-gradient(135deg,#b2bec3,#636e72)",
  "ÏùºÎ≥∏Ïñ¥":"linear-gradient(135deg,#e17055,#d63031)",
  "ÌîÑÎûëÏä§Ïñ¥":"linear-gradient(135deg,#0984e3,#74b9ff)",
};

// Ï†ïÎ†¨ Ïö∞ÏÑ†ÏàúÏúÑ (Í¥ÄÎ¶¨Ïûê¬∑ÌñâÏ†ïÏã§ Î®ºÏ†Ä)
const SORT_PRIORITY = ['ÍµêÏû•','ÍµêÍ∞ê','ÌñâÏ†ïÎ∂ÄÏû•','ÌñâÏ†ïÏã§Ïû•','ÌñâÏ†ïÏã§Î¨¥ÏÇ¨','Ï£ºÎ¨¥Í¥Ä','ÍµêÎ¨¥Ïã§Î¨¥ÏÇ¨'];

let currentBig = 'Ï†ÑÏ≤¥';
let currentSub = null; // nullÏù¥Î©¥ ÎåÄÎ∂ÑÎ•ò Ï†ÑÏ≤¥
let currentContact = null;

// ‚îÄ‚îÄ ÌïÑÌÑ∞ Î†åÎçî ‚îÄ‚îÄ
function buildFilters() {
  // ÎåÄÎ∂ÑÎ•ò Î≤ÑÌäº
  document.getElementById('filterBig').innerHTML = GROUPS.map(g =>
    `<button class="filter-btn-big ${g.label===currentBig?'active':''}" onclick="setBig('${g.label}')">${g.label}</button>`
  ).join('');

  // ÏÜåÎ∂ÑÎ•ò Î≤ÑÌäº (Ï†ÑÏ≤¥ ÏÑ†ÌÉùÏãú Ïà®ÍπÄ, ÏÜåÎ∂ÑÎ•ò 1Í∞úÎ©¥ Ïà®ÍπÄ)
  const group = GROUPS.find(g => g.label === currentBig);
  const subs = group ? group.subs.filter(s => CONTACTS.some(c => c.subject === s)) : [];

  if (subs.length > 1) {
    document.getElementById('filterSub').innerHTML =
      `<button class="filter-btn-sub ${currentSub===null?'active':''}" onclick="setSub(null)">Ï†ÑÏ≤¥</button>` +
      subs.map(s =>
        `<button class="filter-btn-sub ${currentSub===s?'active':''}" onclick="setSub('${s}')">${s}</button>`
      ).join('');
  } else {
    document.getElementById('filterSub').innerHTML = '';
  }
}

function setBig(label) {
  currentBig = label;
  currentSub = null;
  buildFilters();
  filterContacts();
}

function setSub(sub) {
  currentSub = sub;
  buildFilters();
  filterContacts();
}

function onSearch() { filterContacts(); }

// ‚îÄ‚îÄ ÌïÑÌÑ∞ & Î†åÎçî ‚îÄ‚îÄ
function filterContacts() {
  const query = document.getElementById('searchInput').value.toLowerCase().trim();
  const group = GROUPS.find(g => g.label === currentBig);

  let filtered = CONTACTS;

  if (currentBig !== 'Ï†ÑÏ≤¥' && group) {
    if (currentSub) {
      filtered = filtered.filter(c => c.subject === currentSub);
    } else {
      filtered = filtered.filter(c => group.subs.includes(c.subject));
    }
  }

  if (query) {
    filtered = filtered.filter(c =>
      c.name.includes(query) || (c.subject||'').includes(query)
    );
  }

  renderContacts(filtered);
}

function renderContacts(contacts) {
  document.getElementById('countBadge').textContent = `Ï¥ù ${contacts.length}Î™Ö`;
  const list = document.getElementById('contactsList');

  if (contacts.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="emoji">üîç</div><p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</p></div>`;
    return;
  }

  const sorted = [...contacts].sort((a, b) => {
    const ai = SORT_PRIORITY.indexOf(a.subject);
    const bi = SORT_PRIORITY.indexOf(b.subject);
    if (ai !== -1 || bi !== -1) return (ai === -1 ? 99 : ai) - (bi === -1 ? 99 : bi);
    return a.name.localeCompare(b.name, 'ko');
  });

  let html = '';
  let prevInitial = '';

  sorted.forEach((c, i) => {
    const initial = c.name[0];
    if (initial !== prevInitial) {
      html += `<div class="section-label">${initial}</div>`;
      prevInitial = initial;
    }
    const color = SUBJECT_COLORS[c.subject] || "linear-gradient(135deg,#4f7cff,#7c4fff)";
    html += `
      <div class="contact-card" onclick="openSheet(${JSON.stringify(c).replace(/"/g,'&quot;')})" style="animation-delay:${Math.min(i,25)*0.03}s">
        <div class="avatar" style="background:${color}">${c.name[0]}</div>
        <div class="contact-info">
          <div class="contact-name">${c.name}</div>
          ${c.subject?`<div class="contact-subject">${c.subject}</div>`:''}
          <div class="contact-phone">${c.phone}</div>
        </div>
        <div class="card-arrow">‚Ä∫</div>
      </div>`;
  });

  list.innerHTML = html;
}

// ‚îÄ‚îÄ Ïï°ÏÖò ÏãúÌä∏ ‚îÄ‚îÄ
function openSheet(c) {
  currentContact = c;
  const color = SUBJECT_COLORS[c.subject] || "linear-gradient(135deg,#4f7cff,#7c4fff)";
  document.getElementById('sheetAvatar').textContent = c.name[0];
  document.getElementById('sheetAvatar').style.background = color;
  document.getElementById('sheetName').textContent = c.name;
  document.getElementById('sheetSubject').textContent = c.subject;
  document.getElementById('sheetPhone').textContent = c.phone;
  document.getElementById('btnCall').href = 'tel:' + c.phone.replace(/[^0-9]/g,'');
  document.getElementById('sheetOverlay').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeSheet() {
  document.getElementById('sheetOverlay').style.display = 'none';
  document.body.style.overflow = '';
  currentContact = null;
}

function saveContact() {
  if (!currentContact) return;
  const c = currentContact;
  const vcard = [
    "BEGIN:VCARD", "VERSION:3.0",
    "FN:" + c.name,
    "N:" + c.name[0] + ";" + c.name.slice(1) + ";;;",
    "TEL;TYPE=CELL:" + c.phone,
    "TITLE:" + c.subject,
    "END:VCARD"
  ].join("\r\n");

  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  if (isIOS) {
    window.location.href = "data:text/vcard;charset=utf-8," + encodeURIComponent(vcard);
  } else {
    const blob = new Blob([vcard], { type: "text/vcard;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = c.name + ".vcf";
    document.body.appendChild(a); a.click();
    document.body.removeChild(a); URL.revokeObjectURL(url);
  }
  closeSheet();
}

buildFilters();
filterContacts();
</script>
</body>
</html>